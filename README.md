# 明日方舟终末地抽卡模拟器

一个基于蒙特卡洛模拟的明日方舟终末地抽卡策略分析工具，用于量化分析不同抽卡策略和福利方案的效率。

## 📋 项目简介

本模拟器通过大规模蒙特卡洛模拟（默认5000次迭代），模拟玩家在两年内（36个卡池）的抽卡全生命周期，对比分析：
- 6种不同的抽卡策略效率
- 2种福利方案（限时福利 vs 永久福利）的实际价值
- 每个策略下的期望花费、UP获取数量、保底水位分布等

## 🎯 核心模拟思路

1. **模拟周期**：两年内36个卡池的完整生命周期
2. **资源假设**：抽卡资源无限，想要的池子必须抽出UP
3. **初始状态**：首个卡池小保底0、大保底0
4. **跳池处理**：跳过的池子仅使用免费赠送的抽数（60赠10 + 福利10抽）
5. **意外UP**：跳池时意外抽出UP不影响原规划，但计入意外UP统计

## 📐 核心抽卡规则

| 规则项 | 参数 | 说明 |
|--------|------|------|
| 基础概率 | 0.8% | 单次抽取6星基础概率 |
| 小保底 | 80抽 | 必出6星，**可跨池继承** |
| 大保底 | 120抽 | 必出当期UP，**仅当期有效** |
| UP概率 | 50% | 6星为当期UP的概率 |
| 递增保底 | 65抽起 | 未出6星时每抽+5%概率 |
| 30抽奖励 | 送10抽 | **特殊抽**，不计入保底 |
| 60抽奖励 | 送10抽 | **正常抽**，计入保底（上期满60本期送） |

### 重要机制说明

- **小保底**：出6星后重置为0，可跨池继承
- **大保底**：出当期UP后重置为0，仅当期有效，下期清零
- **特殊10抽**（30抽奖励）：完全不影响保底计数，出货不清空小保底
- **正常10抽**（60抽奖励）：每一抽都计入保底，出货重置相应保底
- **往期UP**：小保底歪出往期UP不重置小保底计数器

## 🎲 策略说明

本模拟器实现了6种典型抽卡策略：

| 策略 | 描述 | 期望UP数 | 适用人群 |
|------|------|----------|----------|
| 策略1 | 每期都抽 | 36个 | 全收集玩家 |
| 策略2 | 抽1跳1循环 | 18个 | 稳定型微氪玩家 |
| 策略3 | 两池周期随机选一 | 18个 | XP二选一微氪玩家 |
| 策略4 | 抽1跳2循环 | 12个 | 稳定型0氪玩家 |
| 策略5 | 三池周期随机选一 | 12个 | XP三选一0氪玩家 |
| 策略6 | 三池周期随机选二 | 24个 | XP三选二微中氪玩家 |

## 💎 福利方案对比

模拟器对比两种福利投入方式（每期10抽）：

### 方案1：限时福利
- 每卡池赠送当期限定10抽
- 随卡池过期而失效
- 必须在领取后7天内使用完毕
- 优先级：先使用福利抽再使用自费抽

### 方案2：永久福利
- 每卡池赠送10抽不限时
- 可跨期积攒，在任意卡池使用
- 使用时机：60赠抽和30赠抽消耗完后使用
- 灵活性更高

## 🚀 使用方法

### 环境要求

```bash
Python 3.7+
numpy
matplotlib
seaborn
```

### 安装依赖

```bash
pip install numpy matplotlib seaborn
```

### 运行模拟

```bash
# 1. 运行主模拟程序（约需2-5分钟）
python main.py

# 2. 生成可视化图表
python visualizer.py
```

### 输出内容

**控制台输出**：
- 6种策略的详细统计数据
- 每种策略在3种福利模式下的对比
- 总花费、每UP花费、UP获取数量等

**可视化图表**（5张PNG）：
1. `welfare_efficiency_comparison.png` - 福利方案效率对比
2. `user_spending_comparison.png` - 用户实际花费对比
3. `pity_history.png` - 小保底水位时间线
4. `pity_distribution_histogram.png` - 水位分布直方图
5. `pity_distribution.png` - 水位概率分布曲线

## 📊 统计指标说明

每个策略会输出以下统计指标：

| 指标 | 说明 |
|------|------|
| 总花费 | 用户实际投入的抽数（不含赠送） |
| 期望UP数 | 计划要抽的UP数量 |
| 所有当期UP数 | 期望UP + 跳池意外UP |
| 所有UP数 | 当期UP + 往期歪的UP |
| 期望UP每UP花费 | 总花费 ÷ 期望UP数 |
| 当期UP每UP花费 | 总花费 ÷ 所有当期UP数 |
| 所有UP每UP花费 | 总花费 ÷ 所有UP数 |

## 📁 项目结构

```
gacha_calculate/
├── main.py                    # 主程序入口
├── config.py                  # 配置文件
├── gacha_simulator.py         # 核心抽卡模拟器
├── strategy_simulator.py      # 策略模拟器
├── visualizer.py              # 可视化工具
├── simulation_results.pkl     # 模拟结果缓存
└── *.png                      # 生成的图表文件
```

## 🔧 配置说明

可在 `config.py` 中修改以下参数：

```python
base_ssr_rate = 0.008          # 基础6星概率
small_pity = 80                # 小保底阈值
large_pity = 120               # 大保底阈值
up_rate = 0.5                  # UP概率
increase_threshold = 65        # 递增保底起始
increase_rate = 0.05           # 每抽递增概率
```

## 📈 核心算法

### 小保底水位计算

水位分布统计维度：
- **数据来源**：5000次模拟 × 36个卡池 ≈ 180,000个观测点
- **统计对象**：所有卡池结束时刻的小保底水位值
- **区间精度**：直方图10抽间隔，概率曲线1抽精度
- **意义**：反映整体保底水位的概率分布规律

### 福利价值计算

通过对比相同策略在不同福利模式下的总花费差异，量化福利的实际价值：

```
福利节省 = 基准花费 - 福利模式花费
福利效率 = 福利节省 / 福利投入
```

## 📝 输出示例

```
策略2：抽1跳1循环
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

模拟条件:
  • 模拟次数: 5000
  • 卡池总数: 36
  • 期望UP数: 18
  • 所有当期UP数: 18.45
  • 所有UP数: 19.23

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
用户实际花费 (不含赠送)
┌─────────┬────────────┬────────────┬────────────┐
│ 福利模式 │ 总花费     │ 期望UP每UP │ 当期UP每UP │
│         │           │   花费     │   花费     │
├─────────┼────────────┼────────────┼────────────┤
│ 无福利   │  2234.5   │   124.1    │   121.2    │
│ 限时福利 │  2156.3   │   119.8    │   116.9    │
│ 永久福利 │  2098.7   │   116.6    │   113.8    │
└─────────┴────────────┴────────────┴────────────┘
```

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License

## ⚠️ 免责声明

本项目仅供学习研究使用，模拟结果基于统计规律，实际游戏中的个体体验可能存在差异。
